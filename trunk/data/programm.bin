local g
local b
local c
local b2
local created = false

function init()
	-- create Gadgets
	g = _window( 100 , 60 , 20 , 20 , "Neues Fenster" )
	b = _button( 30 , 20 , 20 , 20 , "Click!" )
	c = _checkbox( 10 , 11 , "Checkbox1 Name" )
	
	-- construct the Tree
	g:addChild( b )
	g:addChild( c )
	registerToWindows( g )
	
	-- register Handler-Functions
	g:registerEventHandler( "dragging" , dragHandler )
	g:registerEventHandler( "dragStart" , dragHandler )
	b:registerEventHandler( "mouseClick" , clickHandler )
	
	-- customize them
	b:setAutoSelect()
	
	-- refresh them
	g:handleEvent( _gadgetEvent( "refresh" ) )
	c:handleEvent( _gadgetEvent( "refresh" ) )
	b:handleEvent( _gadgetEvent( "refresh" ) )
end 
 
-- dragHandler to display Dragging-Params in window-title
function dragHandler( e )
	local dest = e:getArgs():getDestination():toDerived()
	if e:getType() == "dragging" then
		if dest:handleEventDefault( e ) == "not_handled" then
			dest:setTitle( string.format( "%i - Delta: %i" , e:getArgs():getPosX() , e:getArgs():getDeltaX() ) )
		end
	elseif e:getType() == "dragStart" then
		g:handleEventDefault( e )
	end
	return "handled"
end

-- clickHandler to handle Click Events on Button1
function clickHandler()
	if created then
		b2:delete()
	end
	b2 = _button( math.random( 40 ) , 45 , "Ok!" )
	--print( b2 == b )
	g:addChild( b2 )
	b2:handleEvent( _gadgetEvent( "refresh" ) )
	b2:registerEventHandler( "mouseClick" , setValue )
	created = true
	return "handled"
end

function setValue()
	c:setIntValue( math.random( 0 , 2 ) )
	return "handled"
end

--local st,err = pcall(init)
--print(err)