system.require("_window")
system.require("_button")
system.require("_animation")
system.require("_checkbox")
system.require("_select")
system.require("_gadget")
system.require("_direntry")
system.require("_event")
system.require("_counter")

local w;
local w2;
local b;
local c;
local select;
local a;

function main()
	-- create Gadgets
	w = _window( 150 , 80 , 20 , 20 , "Neues Fenster" );
	c = _checkbox( 10 , 11 );
	b = _button( 50,10,"Tehhjwsx" );
	cnt = _counter( 4,40,40,true );
	select = _select( 50 , 2 , 30 , 40 );
	select.addIndex( 0 , "Hello" );
	select.setList( { "HAllo" , "test!" ; "%Allright" } );

	-- construct the Tree
	w.addChild( c );
	w.addChild( cnt );
	w.addChild( select );
	w.addChild( b );
	system.addChild( w );

	-- register Handler-Functions
	w.registerEventHandler( "dragging" , dragHandler );
	w.registerEventHandler( "dragStart" , dragHandler );
	b.registerEventHandler( "onAction" , clickHandler );
	
	--local dir = _direntry("/fat.h")
	--dir.create()
	
	a = _animation( 0 , 50 , 1000 );
	a.easing = "elastic:easeOut";
	a.onSet( setter );

end

-- dragHandler to display Dragging-Params in window-title
function dragHandler( e )
	local dest = e.destination
	if e.type == "dragging" then
		dest.strValue = string.format( "%i - Delta. %i" , e.posX , e.deltaX )
	end
	return "handled"
end

-- clickHandler to handle Click Events on Button1
function clickHandler()
	a.start();
	b2 = _button( math.random( 40 ) , 45 , " rfdv" )
	---b2 = _button( 40 , 10 , "ewf" )
	w.addChild( b2 )
	b2.registerEventHandler( "mouseClick" , setValue )
	select.addIndex( 2 , "Test" )
	return "handled"
end

function setValue()
	c.intValue = math.random( 0 , 2 );
	for k,v in ipairs( select.getList() ) do
		print(v[1] .. ":" .. v[2] .. "\n" );
	end
	--system.exit()
	return "handled"
end

function setter( i )
	b.x = i;
end
